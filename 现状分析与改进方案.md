# Open-AutoGLM ç°çŠ¶åˆ†æä¸æ”¹è¿›æ–¹æ¡ˆ

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

Open-AutoGLM æ˜¯ä¸€ä¸ªåŸºäº ZhipuAI/AutoGLM-Phone-9B æ¨¡å‹çš„æ‰‹æœºè‡ªåŠ¨åŒ–æ§åˆ¶ç³»ç»Ÿï¼Œé€šè¿‡ GUI ç•Œé¢è®©ç”¨æˆ·è¾“å…¥ä»»åŠ¡æŒ‡ä»¤ï¼Œæ¨¡å‹åˆ†æå±å¹•æˆªå›¾å¹¶æ‰§è¡Œç›¸åº”æ“ä½œã€‚

### æ ¸å¿ƒæ¶æ„

```
ç”¨æˆ·è¾“å…¥ä»»åŠ¡ â†’ PhoneAgent â†’ æ¨¡å‹æ¨ç† â†’ åŠ¨ä½œæ‰§è¡Œ â†’ æˆªå›¾åé¦ˆ â†’ å¾ªç¯
```

### ä¸»è¦ç»„ä»¶

| ç»„ä»¶ | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| PhoneAgent | `phone_agent/agent.py` | æ ¸å¿ƒä»£ç†ï¼Œåè°ƒä»»åŠ¡æ‰§è¡Œ |
| ModelClient | `phone_agent/model/client.py` | æ¨¡å‹APIè°ƒç”¨å®¢æˆ·ç«¯ |
| AgentRunner | `gui/utils/agent_runner.py` | GUIä»»åŠ¡æ‰§è¡Œå™¨ |
| ActionHandler | `phone_agent/actions/handler.py` | åŠ¨ä½œæ‰§è¡Œå¤„ç†å™¨ |
| GoldenPathExtractor | `gui/utils/golden_path_extractor.py` | é»„é‡‘è·¯å¾„æå–å™¨ |
| TaskMatcher | `gui/utils/task_matcher.py` | ä»»åŠ¡åŒ¹é…å™¨ |
| ExperienceInjector | `gui/utils/experience_injector.py` | ç»éªŒæ³¨å…¥å™¨ |

---

## äºŒã€ç°æœ‰èƒ½åŠ›åˆ†æ

### 2.1 æç¤ºè¯ç³»ç»Ÿ (prompts.py)

**ä½ç½®**: `phone_agent/config/prompts.py`, `phone_agent/config/prompts_zh.py`

**å·²æœ‰èƒ½åŠ›**:
- å®Œæ•´çš„ç³»ç»Ÿæç¤ºè¯ï¼Œå®šä¹‰äº†æ‰€æœ‰å¯ç”¨æ“ä½œæŒ‡ä»¤
- 20æ¡å¿…é¡»éµå¾ªçš„è§„åˆ™ï¼Œè¦†ç›–å¸¸è§åœºæ™¯
- æ”¯æŒä¸­è‹±æ–‡åŒè¯­

**æ”¯æŒçš„æ“ä½œæŒ‡ä»¤**:
| æŒ‡ä»¤ | åŠŸèƒ½ |
|------|------|
| `do(action="Launch", app="xxx")` | å¯åŠ¨åº”ç”¨ |
| `do(action="Tap", element=[x,y])` | ç‚¹å‡»æ“ä½œ |
| `do(action="Type", text="xxx")` | è¾“å…¥æ–‡æœ¬ |
| `do(action="Swipe", start=[x1,y1], end=[x2,y2])` | æ»‘åŠ¨æ“ä½œ |
| `do(action="Back")` | è¿”å›ä¸Šä¸€é¡µ |
| `do(action="Home")` | å›åˆ°æ¡Œé¢ |
| `do(action="Wait", duration="x seconds")` | ç­‰å¾… |
| `finish(message="xxx")` | ç»“æŸä»»åŠ¡ |

### 2.2 é»„é‡‘è·¯å¾„ç³»ç»Ÿ

**ä½ç½®**: `gui/utils/golden_path_extractor.py`, `gui/utils/golden_path_repository.py`

**å·²æœ‰èƒ½åŠ›**:
- ä»ç”¨æˆ·æ ‡æ³¨çš„æˆåŠŸæ‰§è¡Œä¸­æå–é»„é‡‘è·¯å¾„
- å­˜å‚¨æ­£ç¡®æ­¥éª¤ (`correct_path`)
- å­˜å‚¨ç¦æ­¢æ“ä½œ (`forbidden`)
- å­˜å‚¨å…³é”®æç¤º (`hints`)
- æ”¯æŒè·¯å¾„åˆå¹¶å’Œå»é‡

**æ•°æ®ç»“æ„**:
```python
@dataclass
class GoldenPath:
    task_pattern: str      # ä»»åŠ¡æ¨¡å¼
    apps: List[str]        # æ¶‰åŠçš„åº”ç”¨
    difficulty: str        # éš¾åº¦: simple/medium/complex
    can_replay: bool       # æ˜¯å¦å¯é‡æ”¾
    correct_path: List[str]  # æ­£ç¡®æ­¥éª¤
    forbidden: List[str]     # ç¦æ­¢æ“ä½œ
    hints: List[str]         # å…³é”®æç¤º
    success_rate: float      # æˆåŠŸç‡
    usage_count: int         # ä½¿ç”¨æ¬¡æ•°
```

### 2.3 ä»»åŠ¡åŒ¹é…ç³»ç»Ÿ

**ä½ç½®**: `gui/utils/task_matcher.py`

**å·²æœ‰èƒ½åŠ›**:
- åŸºäºå…³é”®è¯æå–çš„ä»»åŠ¡åŒ¹é…
- Jaccard ç›¸ä¼¼åº¦è®¡ç®—
- åŠ¨ä½œå…³é”®è¯åŠ æƒåŒ¹é…
- ä¸­æ–‡è¯ç»„æå– (2-3å­—ç»„åˆ)

**åŒ¹é…æµç¨‹**:
```
ç”¨æˆ·è¾“å…¥ â†’ æå–å…³é”®è¯ â†’ æŸ¥è¯¢å€™é€‰è·¯å¾„ â†’ è®¡ç®—ç›¸ä¼¼åº¦ â†’ è¿”å›æœ€ä½³åŒ¹é…
```

**åŒ¹é…é˜ˆå€¼**: 0.6 (60%ç›¸ä¼¼åº¦)

### 2.4 ç»éªŒæ³¨å…¥ç³»ç»Ÿ

**ä½ç½®**: `gui/utils/experience_injector.py`

**å·²æœ‰èƒ½åŠ›**:
- è·å–å†å²é”™è¯¯ç¤ºä¾‹ï¼ˆå«æˆªå›¾ï¼‰
- æ„å»ºç»éªŒæ¶ˆæ¯æ³¨å…¥åˆ°æ¨¡å‹ä¸Šä¸‹æ–‡
- æ”¯æŒæˆªå›¾çš„ base64 ç¼–ç 
- æ„å»ºå¢å¼ºçš„ä»»åŠ¡æç¤ºè¯

**æ³¨å…¥æ ¼å¼**:
```
[å†å²é”™è¯¯è®°å½•] åœ¨æ‰§è¡Œç±»ä¼¼ä»»åŠ¡æ—¶ï¼Œä½ åœ¨è¿™ä¸ªç•Œé¢åšäº†é”™è¯¯çš„æ“ä½œã€‚
â†’ æ¨¡å‹é”™è¯¯å“åº”
âŒ é”™äº†ï¼{ç”¨æˆ·çº æ­£}
â†’ æ¨¡å‹è®¤é”™å¹¶è®°ä½
```

### 2.5 ä»»åŠ¡æ‰§è¡Œæµç¨‹

**ä½ç½®**: `gui/utils/agent_runner.py`

**å½“å‰æµç¨‹**:
1. åŒ¹é…é»„é‡‘è·¯å¾„
2. åŠ è½½å†å²é”™è¯¯ç»éªŒ
3. æ„å»ºå¢å¼ºæç¤ºè¯
4. æ³¨å…¥ç»éªŒæ¶ˆæ¯åˆ°ä¸Šä¸‹æ–‡
5. æ‰§è¡Œä»»åŠ¡ï¼ˆå¾ªç¯æ­¥éª¤ï¼‰
6. æ›´æ–°é»„é‡‘è·¯å¾„ç»Ÿè®¡

---

## ä¸‰ã€å½“å‰é—®é¢˜åˆ†æ

### 3.1 ç”¨æˆ·è¾“å…¥è´Ÿæ‹…é‡

**é—®é¢˜**: ç”¨æˆ·éœ€è¦è¾“å…¥è¯¦ç»†çš„ä»»åŠ¡æè¿°ï¼Œæ¨¡å‹æ‰èƒ½å‡†ç¡®æ‰§è¡Œ

**ç¤ºä¾‹**:
```
âŒ ç”¨æˆ·è¾“å…¥: "æ‰“å¼€å¾®ä¿¡"
   â†’ æ¨¡å‹å¯èƒ½ä¸çŸ¥é“å…·ä½“è¦åšä»€ä¹ˆ

âœ… ç”¨æˆ·éœ€è¦è¾“å…¥: "æ‰“å¼€å¾®ä¿¡åº”ç”¨ï¼Œç‚¹å‡»æœç´¢æ¡†ï¼Œæœç´¢å¼ ä¸‰ï¼Œç‚¹å‡»è”ç³»äººï¼Œå‘é€æ¶ˆæ¯ä½ å¥½"
   â†’ æ¨¡å‹æ‰èƒ½å‡†ç¡®æ‰§è¡Œ
```

### 3.2 æ‰§è¡Œè·¯å¾„ä¼˜åŒ–è¢«åŠ¨

**é—®é¢˜**: åªæœ‰ç”¨æˆ·æ‰‹åŠ¨æ ‡æ³¨åæ‰èƒ½å­¦ä¹ ï¼Œæ²¡æœ‰è‡ªåŠ¨ä¼˜åŒ–æœºåˆ¶

**ç°çŠ¶**:
- éœ€è¦ç”¨æˆ·åœ¨ä»»åŠ¡å›é¡¾ç•Œé¢æ‰‹åŠ¨æ ‡æ³¨ correct/wrong/skip
- æ²¡æœ‰è‡ªåŠ¨è¯†åˆ«å†—ä½™æ­¥éª¤çš„èƒ½åŠ›
- æ²¡æœ‰è‡ªåŠ¨å¯¹æ¯”å¤šæ¬¡æ‰§è¡Œæ‰¾å‡ºæœ€ä¼˜è·¯å¾„

### 3.3 ç¼ºå°‘ä»»åŠ¡æ¨¡æ¿

**é—®é¢˜**: æ²¡æœ‰é¢„ç½®çš„å¸¸è§ä»»åŠ¡æ¨¡æ¿ï¼Œæ¯æ¬¡éƒ½ä»é›¶å¼€å§‹

**ç¼ºå¤±**:
- æ²¡æœ‰"æ‰“å¼€å¾®ä¿¡å‘æ¶ˆæ¯"çš„æ ‡å‡†æ¨¡æ¿
- æ²¡æœ‰"æ·˜å®æœç´¢å•†å“"çš„æ ‡å‡†æ¨¡æ¿
- æ²¡æœ‰"ç¾å›¢ç‚¹å¤–å–"çš„æ ‡å‡†æ¨¡æ¿

### 3.4 æç¤ºè¯æ‰©å±•èƒ½åŠ›å¼±

**é—®é¢˜**: å½“å‰çš„æç¤ºè¯å¢å¼ºåªæ˜¯ç®€å•æ‹¼æ¥çº¦æŸï¼Œæ²¡æœ‰æ™ºèƒ½æ‰©å±•

**ç°çŠ¶**:
```python
# å½“å‰å®ç° (experience_injector.py)
def build_enhanced_task_prompt(self, task, golden_path):
    # åªæ˜¯ç®€å•æ‹¼æ¥: "ä»»åŠ¡ã€‚é‡è¦çº¦æŸ:1.ç¦æ­¢xxx,2.æ³¨æ„xxx"
    return f"{task}ã€‚é‡è¦çº¦æŸ:{','.join(constraints)}"
```

### 3.5 æ¨¡å‹èƒ½åŠ›é™åˆ¶

**é—®é¢˜**: AutoGLM-Phone-9B æ˜¯ 9B å‚æ•°çš„å°æ¨¡å‹ï¼Œç†è§£èƒ½åŠ›æœ‰é™

**è¡¨ç°**:
- å¤æ‚æŒ‡ä»¤ç†è§£ä¸å‡†ç¡®
- é•¿ä¸Šä¸‹æ–‡å®¹æ˜“é—å¿˜
- éœ€è¦æ›´æ˜ç¡®ã€æ›´ç®€æ´çš„æŒ‡ä»¤

---

## å››ã€æ”¹è¿›æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šæ€ç»´æ·å¾„æå–ï¼ˆæ ¸å¿ƒæ–¹æ¡ˆï¼‰â­

**æ ¸å¿ƒæ€è·¯**: ä»æ¨¡å‹æˆåŠŸæ‰§è¡Œçš„ thinking æ—¥å¿—ä¸­æå–"æ€ç»´æ·å¾„"ï¼Œè®©æ¨¡å‹å½¢æˆæƒ¯æ€§æ€ç»´

**äººç±»ç±»æ¯”**:
```
ç¬¬ä¸€æ¬¡ç”¨å¾®ä¿¡: ä»”ç»†çœ‹ç•Œé¢ï¼Œæ‰¾æœç´¢æ¡†åœ¨å“ªï¼Œæ€è€ƒæ€ä¹ˆæ“ä½œ
ç”¨äº†10æ¬¡å:   ä¸ç”¨çœ‹å°±çŸ¥é“æœç´¢æ¡†åœ¨é¡¶éƒ¨ï¼Œç›´æ¥ç‚¹ï¼Œå½¢æˆè‚Œè‚‰è®°å¿†
```

**ç³»ç»Ÿå®ç°æµç¨‹**:
```
æˆåŠŸæ‰§è¡Œæ—¶çš„thinkingæ—¥å¿—:
"æˆ‘çœ‹åˆ°å½“å‰ç•Œé¢æ˜¯å¾®ä¿¡ä¸»é¡µï¼Œæœç´¢æ¡†ä½äºé¡¶éƒ¨ä¸­å¤®ä½ç½®(500,80)é™„è¿‘ï¼Œ
 æˆ‘éœ€è¦ç‚¹å‡»æœç´¢æ¡†æ¥æœç´¢è”ç³»äºº..."
    â†“
æ€ç»´æ·å¾„æå–å™¨åˆ†æ:
- åº”ç”¨: å¾®ä¿¡
- åœºæ™¯: ä¸»é¡µ  
- å…ƒç´ : æœç´¢æ¡†
- ä½ç½®æè¿°: é¡¶éƒ¨ä¸­å¤®
- å…¸å‹åæ ‡: (500, 80)
- åŠ¨ä½œ: Tap
    â†“
å­˜å‚¨ä¸ºæ€ç»´æ·å¾„:
{
  "app": "å¾®ä¿¡",
  "scene": "ä¸»é¡µ", 
  "element": "æœç´¢æ¡†",
  "location_hint": "é¡¶éƒ¨ä¸­å¤®",
  "typical_coords": [500, 80],
  "action": "Tap",
  "confidence": 0.95,
  "usage_count": 10
}
    â†“
ä¸‹æ¬¡æ‰§è¡Œæ—¶æ³¨å…¥:
"å¾®ä¿¡ä¸»é¡µçš„æœç´¢æ¡†é€šå¸¸åœ¨é¡¶éƒ¨ä¸­å¤®(500,80)é™„è¿‘ï¼Œå¯ä»¥ç›´æ¥ç‚¹å‡»"
```

**éœ€è¦æ–°å¢çš„ç»„ä»¶**:

| ç»„ä»¶ | åŠŸèƒ½ |
|------|------|
| ThinkingExtractor | ä»thinkingæ—¥å¿—ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯ |
| MentalShortcutRepository | å­˜å‚¨å’ŒæŸ¥è¯¢æ€ç»´æ·å¾„ |
| ShortcutInjector | å°†æ€ç»´æ·å¾„æ³¨å…¥åˆ°æ¨¡å‹ä¸Šä¸‹æ–‡ |
| ShortcutOptimizer | æ ¹æ®æ‰§è¡Œç»“æœä¼˜åŒ–æ·å¾„æƒé‡ |

**thinkingæ—¥å¿—åˆ†æè§„åˆ™**:
```python
# éœ€è¦æå–çš„å…³é”®ä¿¡æ¯
patterns = {
    "location": r"ä½äº(.+?)ä½ç½®",           # ä½ç½®æè¿°
    "coords": r"\((\d+),\s*(\d+)\)",        # åæ ‡
    "element": r"(æœç´¢æ¡†|è¾“å…¥æ¡†|æŒ‰é’®|å›¾æ ‡)", # UIå…ƒç´ 
    "scene": r"å½“å‰ç•Œé¢æ˜¯(.+?)[ï¼Œ,]",        # åœºæ™¯è¯†åˆ«
    "action_reason": r"æˆ‘éœ€è¦(.+?)æ¥",       # åŠ¨ä½œåŸå› 
}
```

**æ€ç»´æ·å¾„æ•°æ®ç»“æ„**:
```python
@dataclass
class MentalShortcut:
    app: str                    # åº”ç”¨å
    scene: str                  # åœºæ™¯/é¡µé¢
    element: str                # UIå…ƒç´ 
    location_hint: str          # ä½ç½®æè¿°ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰
    typical_coords: List[int]   # å…¸å‹åæ ‡ [x, y]
    coord_variance: List[int]   # åæ ‡æ–¹å·®ï¼ˆå…è®¸åç§»èŒƒå›´ï¼‰
    action: str                 # æ¨èåŠ¨ä½œ
    confidence: float           # ç½®ä¿¡åº¦ (0-1)
    usage_count: int            # ä½¿ç”¨æ¬¡æ•°
    success_count: int          # æˆåŠŸæ¬¡æ•°
    source_sessions: List[str]  # æ¥æºä¼šè¯ID
```

**æ³¨å…¥æ ¼å¼ç¤ºä¾‹**:
```
ğŸ“ å†å²ç»éªŒæç¤ºï¼ˆå¾®ä¿¡ä¸»é¡µï¼‰:
- æœç´¢æ¡†: é¡¶éƒ¨ä¸­å¤®ï¼Œçº¦(500,80)ï¼Œç›´æ¥ç‚¹å‡»å³å¯
- é€šè®¯å½•: åº•éƒ¨å¯¼èˆªæ ç¬¬äºŒä¸ªï¼Œçº¦(250,950)
- å‘ç°: åº•éƒ¨å¯¼èˆªæ ç¬¬ä¸‰ä¸ªï¼Œçº¦(500,950)
- æˆ‘: åº•éƒ¨å¯¼èˆªæ ç¬¬å››ä¸ªï¼Œçº¦(750,950)

æ ¹æ®å†å²æ‰§è¡Œç»éªŒï¼Œè¿™äº›ä½ç½®é€šå¸¸æ˜¯å‡†ç¡®çš„ï¼Œå¯ä»¥ç›´æ¥æ“ä½œã€‚
```

**ä¸ç°æœ‰ç³»ç»Ÿçš„åŒºåˆ«**:

| å¯¹æ¯”é¡¹ | ç°æœ‰é»„é‡‘è·¯å¾„ | æ€ç»´æ·å¾„ï¼ˆæ–°ï¼‰ |
|--------|-------------|---------------|
| æ•°æ®æ¥æº | ç”¨æˆ·æ‰‹åŠ¨æ ‡æ³¨ | è‡ªåŠ¨ä»thinkingæå– |
| ç²’åº¦ | ä»»åŠ¡çº§åˆ« | å…ƒç´ çº§åˆ« |
| å†…å®¹ | æ­¥éª¤åˆ—è¡¨ | ä½ç½®+åæ ‡+åŠ¨ä½œ |
| å¤ç”¨æ–¹å¼ | åŒ¹é…ç›¸ä¼¼ä»»åŠ¡ | åŒ¹é…ç›¸åŒåœºæ™¯ |
| å­¦ä¹ æ–¹å¼ | è¢«åŠ¨ï¼ˆéœ€æ ‡æ³¨ï¼‰ | ä¸»åŠ¨ï¼ˆè‡ªåŠ¨æå–ï¼‰ |

### æ–¹æ¡ˆäºŒï¼šæ‰§è¡Œè·¯å¾„è‡ªåŠ¨ä¼˜åŒ–

**ç›®æ ‡**: ç³»ç»Ÿè‡ªåŠ¨å­¦ä¹ å’Œä¼˜åŒ–æ‰§è¡Œè·¯å¾„

**æ¶æ„**:
```
ç¬¬1æ¬¡æ‰§è¡Œ: è®°å½•å®Œæ•´è·¯å¾„ [Aâ†’Bâ†’Câ†’Dâ†’Eâ†’F] (6æ­¥)
ç¬¬2æ¬¡æ‰§è¡Œ: è®°å½•å®Œæ•´è·¯å¾„ [Aâ†’Bâ†’Dâ†’Eâ†’F] (5æ­¥ï¼Œè·³è¿‡C)
ç¬¬3æ¬¡æ‰§è¡Œ: è®°å½•å®Œæ•´è·¯å¾„ [Aâ†’Bâ†’Dâ†’F] (4æ­¥ï¼Œè·³è¿‡Cå’ŒE)
    â†“
è·¯å¾„åˆ†æ: å‘ç°Cå’ŒEæ˜¯å¯é€‰æ­¥éª¤
    â†“
ä¼˜åŒ–è·¯å¾„: [Aâ†’Bâ†’Dâ†’F] ä½œä¸ºæœ€ä¼˜è·¯å¾„
```

**éœ€è¦æ–°å¢çš„ç»„ä»¶**:

| ç»„ä»¶ | åŠŸèƒ½ |
|------|------|
| PathRecorder | è·¯å¾„è®°å½•å™¨ï¼Œè®°å½•æ¯æ¬¡æ‰§è¡Œçš„å®Œæ•´è·¯å¾„ |
| PathAnalyzer | è·¯å¾„åˆ†æå™¨ï¼Œåˆ†æå¤šæ¬¡æ‰§è¡Œæ‰¾å‡ºæ¨¡å¼ |
| PathOptimizer | è·¯å¾„ä¼˜åŒ–å™¨ï¼Œç”Ÿæˆæœ€ä¼˜è·¯å¾„ |
| AutoFeedback | è‡ªåŠ¨åé¦ˆï¼Œæ ¹æ®æ‰§è¡Œç»“æœæ›´æ–°è·¯å¾„æƒé‡ |

**ä¼˜åŒ–ç­–ç•¥**:
1. **æ­¥éª¤åˆå¹¶**: è¿ç»­çš„ç›¸ä¼¼æ“ä½œåˆå¹¶ä¸ºä¸€æ­¥
2. **å†—ä½™åˆ é™¤**: åˆ é™¤å¯¹ç»“æœæ— å½±å“çš„æ­¥éª¤
3. **é¡ºåºä¼˜åŒ–**: è°ƒæ•´æ­¥éª¤é¡ºåºæé«˜æ•ˆç‡
4. **å¤±è´¥å›é€€**: å¤±è´¥æ—¶è‡ªåŠ¨å°è¯•å¤‡é€‰è·¯å¾„

### æ–¹æ¡ˆä¸‰ï¼šåˆ†å±‚æç¤ºè¯ç³»ç»Ÿ

**ç›®æ ‡**: å»ºç«‹ä¸‰å±‚æç¤ºè¯ä½“ç³»ï¼Œé€å±‚ç»†åŒ–

**æ¶æ„**:
```
Layer 1 (ç”¨æˆ·å±‚): "å‘å¾®ä¿¡ç»™å¼ ä¸‰"
    â†“
Layer 2 (ä»»åŠ¡å±‚): "1.æ‰“å¼€å¾®ä¿¡ 2.æ‰¾åˆ°å¼ ä¸‰ 3.å‘é€æ¶ˆæ¯"
    â†“
Layer 3 (æ“ä½œå±‚): "Launchå¾®ä¿¡ â†’ Tapæœç´¢ â†’ Typeå¼ ä¸‰ â†’ Tapè”ç³»äºº â†’ ..."
```

**å®ç°æ–¹å¼**:
```python
class LayeredPromptSystem:
    def expand_user_input(self, user_input: str) -> str:
        """Layer 1 â†’ Layer 2: ç”¨æˆ·è¾“å…¥è½¬ä»»åŠ¡åˆ†è§£"""
        intent = self.recognize_intent(user_input)
        tasks = self.decompose_to_tasks(intent)
        return tasks
    
    def expand_to_operations(self, tasks: List[str]) -> str:
        """Layer 2 â†’ Layer 3: ä»»åŠ¡åˆ†è§£è½¬å…·ä½“æ“ä½œ"""
        operations = []
        for task in tasks:
            ops = self.task_to_operations(task)
            operations.extend(ops)
        return operations
```

---

## äº”ã€æ¨èå®æ–½è·¯å¾„

### ç¬¬ä¸€é˜¶æ®µï¼šæ€ç»´æ·å¾„ç³»ç»Ÿï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰â­

1. åˆ›å»º `ThinkingExtractor` ç±» - ä»thinkingæ—¥å¿—æå–ç»“æ„åŒ–ä¿¡æ¯
2. åˆ›å»º `MentalShortcutRepository` ç±» - å­˜å‚¨æ€ç»´æ·å¾„åˆ°æ•°æ®åº“
3. åˆ›å»º `ShortcutInjector` ç±» - å°†æ·å¾„æ³¨å…¥æ¨¡å‹ä¸Šä¸‹æ–‡
4. ä¿®æ”¹ `AgentRunner` - é›†æˆæ€ç»´æ·å¾„ç³»ç»Ÿ

**é¢„æœŸæ•ˆæœ**: 
- æ¨¡å‹æ‰§è¡ŒæˆåŠŸåè‡ªåŠ¨å­¦ä¹ "å¾®ä¿¡æœç´¢æ¡†åœ¨é¡¶éƒ¨"è¿™ç±»ç»éªŒ
- ä¸‹æ¬¡æ‰§è¡Œæ—¶ç›´æ¥å‘Šè¯‰æ¨¡å‹ä½ç½®ï¼Œä¸ç”¨é‡æ–°åˆ†æ

### ç¬¬äºŒé˜¶æ®µï¼šæ‰§è¡Œè·¯å¾„è‡ªåŠ¨ä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ä¸­ï¼‰

1. å¢å¼ºè·¯å¾„è®°å½•ï¼Œè®°å½•æ¯æ­¥çš„å¿…è¦æ€§
2. å®ç°è·¯å¾„å¯¹æ¯”åˆ†æ
3. è‡ªåŠ¨è¯†åˆ«å†—ä½™æ­¥éª¤
4. ç”Ÿæˆä¼˜åŒ–åçš„è·¯å¾„

**é¢„æœŸæ•ˆæœ**: åŒä¸€ä»»åŠ¡æ‰§è¡Œå¤šæ¬¡åï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰¾å‡ºæœ€çŸ­è·¯å¾„

### ç¬¬ä¸‰é˜¶æ®µï¼šæ™ºèƒ½æç¤ºè¯ç”Ÿæˆï¼ˆä¼˜å…ˆçº§ä½ï¼‰

1. åŸºäºå†å²æ•°æ®è®­ç»ƒæ„å›¾è¯†åˆ«æ¨¡å‹
2. å®ç°æ›´æ™ºèƒ½çš„å‚æ•°æå–
3. æ”¯æŒå¤æ‚ä»»åŠ¡çš„è‡ªåŠ¨åˆ†è§£

**é¢„æœŸæ•ˆæœ**: ç³»ç»Ÿèƒ½ç†è§£æ›´å¤æ‚çš„ç”¨æˆ·æŒ‡ä»¤

---

## å…­ã€æŠ€æœ¯å®ç°å»ºè®®

### 6.1 æ€ç»´æ·å¾„æå–å™¨å®ç°

```python
import re
from dataclasses import dataclass
from typing import List, Optional, Dict, Any

@dataclass
class MentalShortcut:
    """æ€ç»´æ·å¾„æ•°æ®ç±»"""
    app: str                    # åº”ç”¨å
    scene: str                  # åœºæ™¯/é¡µé¢
    element: str                # UIå…ƒç´ 
    location_hint: str          # ä½ç½®æè¿°
    typical_coords: List[int]   # å…¸å‹åæ ‡
    action: str                 # æ¨èåŠ¨ä½œ
    confidence: float = 1.0     # ç½®ä¿¡åº¦
    usage_count: int = 1        # ä½¿ç”¨æ¬¡æ•°
    success_count: int = 1      # æˆåŠŸæ¬¡æ•°


class ThinkingExtractor:
    """ä»thinkingæ—¥å¿—ä¸­æå–æ€ç»´æ·å¾„"""
    
    # ä½ç½®æè¿°æ¨¡å¼
    LOCATION_PATTERNS = [
        r"ä½äº(.+?)ä½ç½®",
        r"åœ¨(.+?)(?:å¤„|ä½ç½®|åœ°æ–¹)",
        r"(.+?)(?:é™„è¿‘|åŒºåŸŸ|éƒ¨åˆ†)",
    ]
    
    # åæ ‡æå–æ¨¡å¼
    COORD_PATTERNS = [
        r"\((\d+),\s*(\d+)\)",
        r"\[(\d+),\s*(\d+)\]",
        r"(\d+),\s*(\d+)",
    ]
    
    # UIå…ƒç´ æ¨¡å¼
    ELEMENT_PATTERNS = [
        r"(æœç´¢æ¡†|è¾“å…¥æ¡†|æŒ‰é’®|å›¾æ ‡|æ ‡ç­¾|å¯¼èˆªæ |èœå•)",
        r"(å‘é€|ç¡®è®¤|å–æ¶ˆ|è¿”å›|è®¾ç½®|æ›´å¤š)(?:æŒ‰é’®)?",
    ]
    
    # åœºæ™¯è¯†åˆ«æ¨¡å¼
    SCENE_PATTERNS = [
        r"å½“å‰(?:ç•Œé¢|é¡µé¢|å±å¹•)æ˜¯(.+?)[ï¼Œ,ã€‚]",
        r"è¿›å…¥äº†(.+?)(?:ç•Œé¢|é¡µé¢)",
        r"(.+?)(?:ä¸»é¡µ|é¦–é¡µ|è¯¦æƒ…é¡µ)",
    ]
    
    def extract_from_thinking(
        self, 
        thinking: str, 
        action: Dict[str, Any],
        app: str = ""
    ) -> Optional[MentalShortcut]:
        """
        ä»å•æ¡thinkingæ—¥å¿—æå–æ€ç»´æ·å¾„
        
        Args:
            thinking: æ¨¡å‹çš„æ€è€ƒæ—¥å¿—
            action: æ‰§è¡Œçš„åŠ¨ä½œ
            app: å½“å‰åº”ç”¨å
            
        Returns:
            æå–çš„æ€ç»´æ·å¾„ï¼Œå¦‚æœæ— æ³•æå–åˆ™è¿”å›None
        """
        if not thinking:
            return None
        
        # æå–åœºæ™¯
        scene = self._extract_scene(thinking)
        
        # æå–å…ƒç´ 
        element = self._extract_element(thinking)
        
        # æå–ä½ç½®æè¿°
        location_hint = self._extract_location(thinking)
        
        # æå–åæ ‡
        coords = self._extract_coords(thinking, action)
        
        # æå–åŠ¨ä½œç±»å‹
        action_type = action.get('action', '') if action else ''
        
        # å¦‚æœå…³é”®ä¿¡æ¯ä¸è¶³ï¼Œè¿”å›None
        if not element or not coords:
            return None
        
        return MentalShortcut(
            app=app,
            scene=scene or "æœªçŸ¥é¡µé¢",
            element=element,
            location_hint=location_hint or "æœªçŸ¥ä½ç½®",
            typical_coords=coords,
            action=action_type,
        )
    
    def _extract_scene(self, thinking: str) -> str:
        """æå–åœºæ™¯æè¿°"""
        for pattern in self.SCENE_PATTERNS:
            match = re.search(pattern, thinking)
            if match:
                return match.group(1).strip()
        return ""
    
    def _extract_element(self, thinking: str) -> str:
        """æå–UIå…ƒç´ """
        for pattern in self.ELEMENT_PATTERNS:
            match = re.search(pattern, thinking)
            if match:
                return match.group(1).strip()
        return ""
    
    def _extract_location(self, thinking: str) -> str:
        """æå–ä½ç½®æè¿°"""
        for pattern in self.LOCATION_PATTERNS:
            match = re.search(pattern, thinking)
            if match:
                return match.group(1).strip()
        return ""
    
    def _extract_coords(
        self, 
        thinking: str, 
        action: Dict[str, Any]
    ) -> List[int]:
        """æå–åæ ‡"""
        # ä¼˜å…ˆä»actionä¸­è·å–
        if action:
            element = action.get('element', [])
            if isinstance(element, list) and len(element) == 2:
                return element
        
        # ä»thinkingä¸­æå–
        for pattern in self.COORD_PATTERNS:
            match = re.search(pattern, thinking)
            if match:
                try:
                    x = int(match.group(1))
                    y = int(match.group(2))
                    return [x, y]
                except (ValueError, IndexError):
                    continue
        
        return []
```

### 6.2 æ€ç»´æ·å¾„æ³¨å…¥å™¨å®ç°

```python
class ShortcutInjector:
    """å°†æ€ç»´æ·å¾„æ³¨å…¥åˆ°æ¨¡å‹ä¸Šä¸‹æ–‡"""
    
    def __init__(self, repository: 'MentalShortcutRepository'):
        self.repository = repository
    
    def build_shortcut_prompt(
        self, 
        app: str, 
        scene: str = ""
    ) -> str:
        """
        æ„å»ºæ€ç»´æ·å¾„æç¤ºè¯
        
        Args:
            app: å½“å‰åº”ç”¨
            scene: å½“å‰åœºæ™¯ï¼ˆå¯é€‰ï¼‰
            
        Returns:
            æ ¼å¼åŒ–çš„æç¤ºè¯
        """
        # æŸ¥è¯¢ç›¸å…³æ·å¾„
        shortcuts = self.repository.find_by_app(app)
        
        if not shortcuts:
            return ""
        
        # æŒ‰åœºæ™¯åˆ†ç»„
        by_scene = {}
        for shortcut in shortcuts:
            s = shortcut.scene
            if s not in by_scene:
                by_scene[s] = []
            by_scene[s].append(shortcut)
        
        # æ„å»ºæç¤ºè¯
        lines = ["ğŸ“ å†å²æ“ä½œç»éªŒæç¤º:"]
        
        for scene_name, scene_shortcuts in by_scene.items():
            lines.append(f"\nã€{app} - {scene_name}ã€‘")
            for sc in scene_shortcuts:
                coord_str = f"({sc.typical_coords[0]},{sc.typical_coords[1]})"
                confidence_str = f"{sc.confidence:.0%}" if sc.confidence < 1 else ""
                lines.append(
                    f"  - {sc.element}: {sc.location_hint}ï¼Œçº¦{coord_str} "
                    f"â†’ {sc.action} {confidence_str}"
                )
        
        lines.append("\næ ¹æ®å†å²æ‰§è¡Œç»éªŒï¼Œè¿™äº›ä½ç½®é€šå¸¸æ˜¯å‡†ç¡®çš„ï¼Œå¯ä»¥ç›´æ¥æ“ä½œã€‚")
        
        return "\n".join(lines)
```

### 6.3 æ•°æ®åº“è¡¨ç»“æ„

```sql
CREATE TABLE IF NOT EXISTS mental_shortcuts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    app TEXT NOT NULL,
    scene TEXT NOT NULL,
    element TEXT NOT NULL,
    location_hint TEXT,
    typical_coords TEXT,  -- JSON: [x, y]
    coord_variance TEXT,  -- JSON: [var_x, var_y]
    action TEXT,
    confidence REAL DEFAULT 1.0,
    usage_count INTEGER DEFAULT 1,
    success_count INTEGER DEFAULT 1,
    source_sessions TEXT,  -- JSON: [session_id, ...]
    created_at TEXT,
    updated_at TEXT
);

CREATE INDEX idx_shortcuts_app ON mental_shortcuts(app);
CREATE INDEX idx_shortcuts_app_scene ON mental_shortcuts(app, scene);
```

---

## ä¸ƒã€æ–‡ä»¶ç»“æ„å»ºè®®

```
Open-AutoGLM-main/
â”œâ”€â”€ gui/
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ thinking_extractor.py       # æ–°å¢ï¼šæ€ç»´æ·å¾„æå–å™¨
â”‚       â”œâ”€â”€ mental_shortcut_repository.py # æ–°å¢ï¼šæ€ç»´æ·å¾„å­˜å‚¨
â”‚       â”œâ”€â”€ shortcut_injector.py        # æ–°å¢ï¼šæ·å¾„æ³¨å…¥å™¨
â”‚       â”œâ”€â”€ shortcut_optimizer.py       # æ–°å¢ï¼šæ·å¾„ä¼˜åŒ–å™¨
â”‚       â”œâ”€â”€ path_optimizer.py           # æ–°å¢ï¼šè·¯å¾„ä¼˜åŒ–å™¨
â”‚       â””â”€â”€ ... (ç°æœ‰æ–‡ä»¶)
â””â”€â”€ ... (ç°æœ‰æ–‡ä»¶)
```

---

## å…«ã€æ€»ç»“

### ç°æœ‰ä¼˜åŠ¿
- å®Œå–„çš„é»„é‡‘è·¯å¾„å­¦ä¹ ç³»ç»Ÿ
- ç»éªŒæ³¨å…¥æœºåˆ¶å·²å®ç°
- ä»»åŠ¡åŒ¹é…åŸºç¡€å·²æœ‰
- thinkingæ—¥å¿—å·²å®Œæ•´è®°å½•

### ä¸»è¦å·®è·
- æ²¡æœ‰ä»thinkingä¸­è‡ªåŠ¨æå–ç»éªŒ
- ç¼ºå°‘å…ƒç´ çº§åˆ«çš„ä½ç½®è®°å¿†
- ç¼ºå°‘è‡ªåŠ¨è·¯å¾„ä¼˜åŒ–

### æ¨èä¼˜å…ˆçº§
1. **æœ€é«˜**: æ€ç»´æ·å¾„ç³»ç»Ÿï¼ˆä»thinkingè‡ªåŠ¨å­¦ä¹ ï¼‰
2. **ä¸­**: æ‰§è¡Œè·¯å¾„è‡ªåŠ¨ä¼˜åŒ–
3. **ä½**: ä»»åŠ¡æ¨¡æ¿åº“ï¼ˆå¯é€‰ï¼‰

### æ ¸å¿ƒæ”¹è¿›ç‚¹
**ä»"è¢«åŠ¨å­¦ä¹ "è½¬å‘"ä¸»åŠ¨å­¦ä¹ "**ï¼š
- ç°åœ¨ï¼šç”¨æˆ·æ ‡æ³¨ â†’ ç³»ç»Ÿå­¦ä¹ 
- æ”¹è¿›åï¼šæˆåŠŸæ‰§è¡Œ â†’ è‡ªåŠ¨æå–thinking â†’ å½¢æˆæ€ç»´æ·å¾„ â†’ ä¸‹æ¬¡ç›´æ¥ä½¿ç”¨

é€šè¿‡ä»¥ä¸Šæ”¹è¿›ï¼Œæ¨¡å‹å¯ä»¥åƒäººä¸€æ ·å½¢æˆ"è‚Œè‚‰è®°å¿†"ï¼Œä¸ç”¨æ¯æ¬¡éƒ½é‡æ–°åˆ†æç•Œé¢ã€‚


---

## ä¹ã€ä¸ ChatGPT çš„äº¤æµè®¨è®º

### 9.1 ChatGPT çš„æ ¸å¿ƒè§‚ç‚¹ï¼ˆæ¥è‡ª ChatGPTæ€è€ƒ.mdï¼‰

ChatGPT å¯¹æ€ç»´æ·å¾„æ–¹æ¡ˆæå‡ºäº†å‡ ä¸ªé‡è¦çš„**æ½œåœ¨é—®é¢˜**ï¼š

#### é—®é¢˜1ï¼šThinkingè´¨é‡ä¸ç¨³å®š
> 9Bæ¨¡å‹çš„thinkingå¯èƒ½ä¸å¤Ÿç»“æ„åŒ–ï¼Œå®é™…å¯èƒ½æ˜¯"éœ€è¦æœç´¢ï¼Œæ‰¾æœç´¢æ¡†ï¼Œç‚¹å‡»"è€Œä¸æ˜¯"æœç´¢æ¡†ä½äºé¡¶éƒ¨ä¸­å¤®(500,80)"

**Kiroçš„å›åº”**ï¼š
è¿™ä¸ªé—®é¢˜ç¡®å®å­˜åœ¨ã€‚è§£å†³æ–¹æ¡ˆæ˜¯**å¤šæºèåˆæå–**ï¼š
```python
# ä¼˜å…ˆçº§ï¼šactionåæ ‡ > thinkingæ–‡æœ¬
coords = action.get('element', [])  # æœ€å¯é ï¼Œç›´æ¥ä»æ‰§è¡ŒåŠ¨ä½œè·å–
thinking_hint = extract_from_thinking(thinking)  # è¡¥å……ä½ç½®æè¿°
```
åæ ‡ä» `action` ä¸­è·å–æ˜¯100%å‡†ç¡®çš„ï¼Œthinkingåªç”¨æ¥æå–"é¡¶éƒ¨ä¸­å¤®"è¿™ç±»ä½ç½®æè¿°ä½œä¸ºè¾…åŠ©ã€‚

#### é—®é¢˜2ï¼šåæ ‡ç¨³å®šæ€§é—®é¢˜
> ä¸åŒè®¾å¤‡åˆ†è¾¨ç‡ä¸åŒï¼Œåæ ‡ä¼šå˜åŒ–ï¼›UIç‰ˆæœ¬æ›´æ–°å¯èƒ½å¯¼è‡´ä½ç½®å˜åŒ–

**Kiroçš„å›åº”**ï¼š
åŒæ„è¿™ä¸ªé—®é¢˜ã€‚è§£å†³æ–¹æ¡ˆï¼š
1. **ä½¿ç”¨å½’ä¸€åŒ–åæ ‡**ï¼šç³»ç»Ÿå·²ç»ä½¿ç”¨ 0-999 çš„å½’ä¸€åŒ–åæ ‡ç³»ç»Ÿï¼Œä¸åˆ†è¾¨ç‡æ— å…³
2. **åæ ‡èŒƒå›´è€Œéå›ºå®šå€¼**ï¼šå­˜å‚¨ `coord_variance` å…è®¸åç§»èŒƒå›´
3. **ç›¸å¯¹ä½ç½®æè¿°**ï¼šåŒæ—¶å­˜å‚¨"é¡¶éƒ¨ä¸­å¤®"è¿™ç±»ç›¸å¯¹æè¿°ï¼Œä½œä¸ºå›é€€

#### é—®é¢˜3ï¼šåœºæ™¯è¯†åˆ«å‡†ç¡®æ€§
> "å¾®ä¿¡ä¸»é¡µ"vs"å¾®ä¿¡èŠå¤©é¡µ"å¦‚ä½•å‡†ç¡®åŒºåˆ†ï¼Ÿ

**Kiroçš„å›åº”**ï¼š
è¿™æ˜¯ä¸ªå¥½é—®é¢˜ã€‚å½“å‰æ–¹æ¡ˆï¼š
1. **ä» `current_app` è·å–åº”ç”¨å**ï¼šè¿™æ˜¯å‡†ç¡®çš„
2. **ä» thinking æå–åœºæ™¯**ï¼šå¯èƒ½ä¸å‡†ç¡®
3. **æ”¹è¿›æ–¹æ¡ˆ**ï¼šå¯ä»¥ç»“åˆæˆªå›¾ç‰¹å¾ï¼ˆå¦‚åº•éƒ¨å¯¼èˆªæ æ˜¯å¦å­˜åœ¨ï¼‰æ¥è¾…åŠ©åˆ¤æ–­

#### é—®é¢˜4ï¼šæ•°æ®è´¨é‡ä¸å™ªéŸ³
> Thinkingä¸­å¯èƒ½åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œå¦‚ä½•ç¡®ä¿æå–çš„æ·å¾„æ˜¯å¯é çš„ï¼Ÿ

**Kiroçš„å›åº”**ï¼š
å®Œå…¨åŒæ„ã€‚å¿…é¡»æœ‰**ä¸¥æ ¼çš„éªŒè¯æœºåˆ¶**ï¼š
```python
# åªæ³¨å…¥é«˜ç½®ä¿¡åº¦çš„æ·å¾„
if shortcut.usage_count >= 3 and shortcut.success_rate >= 0.8:
    inject_shortcut(shortcut)
else:
    skip  # è®©æ¨¡å‹è‡ªå·±åˆ†æ
```

### 9.2 ChatGPT çš„æ”¹è¿›å»ºè®®

ChatGPT æå‡ºäº†**å¢å¼ºç‰ˆæ€ç»´æ·å¾„ç³»ç»Ÿ**ï¼Œæ ¸å¿ƒæ”¹è¿›ï¼š

1. **å¤šæºèåˆæå–**ï¼ˆå·²é‡‡çº³ï¼‰
   - actionåæ ‡ > thinkingæ–‡æœ¬
   - ä¸ä¾èµ–å•ä¸€æ•°æ®æº

2. **ç›¸å¯¹ä½ç½® + åæ ‡èŒƒå›´**ï¼ˆå·²é‡‡çº³ï¼‰
   ```python
   relative_position: str  # "é¡¶éƒ¨ä¸­å¤®"
   typical_coords: List[int]  # [500, 80]
   coord_variance: List[int]  # [Â±50, Â±20]
   ```

3. **æ¸è¿›å¼å­¦ä¹ **ï¼ˆæ–°å¢é‡‡çº³ï¼‰
   - ç¬¬ä¸€é˜¶æ®µï¼šåªæå–æ˜ç¡®ä¿¡æ¯ï¼ˆåæ ‡ã€åŠ¨ä½œï¼‰
   - ç¬¬äºŒé˜¶æ®µï¼šå¢åŠ åœºæ™¯è¯†åˆ«
   - ç¬¬ä¸‰é˜¶æ®µï¼šè‡ªé€‚åº”ä¼˜åŒ–

4. **è‡ªé€‚åº”æ³¨å…¥**ï¼ˆæ–°å¢é‡‡çº³ï¼‰
   - è®¾ç½®ç½®ä¿¡åº¦é˜ˆå€¼
   - ä½è´¨é‡æ·å¾„ä¸æ³¨å…¥
   - æ·»åŠ å…è´£å£°æ˜è®©æ¨¡å‹å¯ä»¥å›é€€

### 9.3 Kiro çš„è¡¥å……è§‚ç‚¹

#### å…³äº"åˆ†å±‚æç¤ºè¯ç³»ç»Ÿ"

ChatGPT æå‡ºçš„ä¸‰å±‚æ¶æ„å¾ˆæœ‰ä»·å€¼ï¼š
```
Layer 1 (ç”¨æˆ·å±‚): "å‘å¾®ä¿¡ç»™å¼ ä¸‰"
Layer 2 (ä»»åŠ¡å±‚): "1.æ‰“å¼€å¾®ä¿¡ 2.æ‰¾åˆ°å¼ ä¸‰ 3.å‘é€æ¶ˆæ¯"
Layer 3 (æ“ä½œå±‚): å…·ä½“åæ ‡å’ŒåŠ¨ä½œ
```

**Kiroçš„çœ‹æ³•**ï¼š
- Layer 1 â†’ Layer 2ï¼šå¯ä»¥åˆ©ç”¨ç°æœ‰çš„ `correct_path` å®ç°
- Layer 2 â†’ Layer 3ï¼šè¿™æ­£æ˜¯æ€ç»´æ·å¾„è¦è§£å†³çš„é—®é¢˜

ä¸¤è€…å¯ä»¥ç»“åˆï¼š
```
é»„é‡‘è·¯å¾„æä¾›ä»»åŠ¡åˆ†è§£ï¼ˆLayer 2ï¼‰
æ€ç»´æ·å¾„æä¾›å…ƒç´ ä½ç½®ï¼ˆLayer 3ï¼‰
```

#### å…³äº"ç»Ÿä¸€ç»éªŒç³»ç»Ÿ"

ChatGPT æå‡ºæ•´åˆé»„é‡‘è·¯å¾„å’Œæ€ç»´æ·å¾„ï¼Œè¿™ä¸ªæ€è·¯å¾ˆå¥½ï¼š

```python
def build_enhanced_prompt(task, golden_path, shortcuts):
    prompt = task
    
    # Layer 1: é»„é‡‘è·¯å¾„ï¼ˆä»»åŠ¡çº§æŒ‡å¯¼ï¼‰
    if golden_path:
        prompt += "\nğŸ“‹ ä»»åŠ¡æ­¥éª¤ï¼š" + golden_path.correct_path
        prompt += "\nâŒ ç¦æ­¢æ“ä½œï¼š" + golden_path.forbidden
    
    # Layer 2: æ€ç»´æ·å¾„ï¼ˆå…ƒç´ çº§æŒ‡å¯¼ï¼‰
    if shortcuts:
        prompt += "\nğŸ“ ç•Œé¢å…ƒç´ ä½ç½®ï¼š" + format_shortcuts(shortcuts)
    
    return prompt
```

### 9.4 è¾¾æˆå…±è¯†

| è®®é¢˜ | ChatGPTè§‚ç‚¹ | Kiroè§‚ç‚¹ | å…±è¯† |
|------|------------|---------|------|
| æ ¸å¿ƒæ–¹æ¡ˆ | æ€ç»´æ·å¾„ç³»ç»Ÿ | æ€ç»´æ·å¾„ç³»ç»Ÿ | âœ… ä¸€è‡´ |
| æ•°æ®æ¥æº | å¤šæºèåˆ | ä¼˜å…ˆaction | âœ… é‡‡çº³å¤šæºèåˆ |
| åæ ‡å¤„ç† | ç›¸å¯¹ä½ç½®+èŒƒå›´ | å½’ä¸€åŒ–åæ ‡ | âœ… ä¸¤è€…ç»“åˆ |
| è´¨é‡æ§åˆ¶ | ä¸¥æ ¼éªŒè¯ | ç½®ä¿¡åº¦é˜ˆå€¼ | âœ… ä¸€è‡´ |
| å®æ–½ç­–ç•¥ | æ¸è¿›å¼ | åˆ†é˜¶æ®µ | âœ… ä¸€è‡´ |
| ç³»ç»Ÿæ•´åˆ | ç»Ÿä¸€ç»éªŒç³»ç»Ÿ | ä¸é»„é‡‘è·¯å¾„ååŒ | âœ… é‡‡çº³ç»Ÿä¸€ç³»ç»Ÿ |

### 9.5 æœ€ç»ˆæ–¹æ¡ˆç¡®è®¤

åŸºäºä¸ ChatGPT çš„è®¨è®ºï¼Œæœ€ç»ˆæ–¹æ¡ˆï¼š

**æ ¸å¿ƒï¼šå¢å¼ºç‰ˆæ€ç»´æ·å¾„ç³»ç»Ÿ**

1. **æ•°æ®æå–**ï¼šå¤šæºèåˆï¼ˆactionä¼˜å…ˆ + thinkingè¡¥å……ï¼‰
2. **æ•°æ®å­˜å‚¨**ï¼šç›¸å¯¹ä½ç½® + å½’ä¸€åŒ–åæ ‡ + åæ ‡èŒƒå›´
3. **è´¨é‡æ§åˆ¶**ï¼šä½¿ç”¨æ¬¡æ•°â‰¥3ï¼ŒæˆåŠŸç‡â‰¥80%æ‰æ³¨å…¥
4. **ç³»ç»Ÿæ•´åˆ**ï¼šä¸é»„é‡‘è·¯å¾„ååŒï¼Œå½¢æˆç»Ÿä¸€ç»éªŒç³»ç»Ÿ
5. **å®æ–½ç­–ç•¥**ï¼šæ¸è¿›å¼ï¼Œå…ˆä¿å®ˆåæ‰©å±•

**é¢„æœŸæ•ˆæœ**ï¼š
- æ¨¡å‹å½¢æˆ"ä½ç½®è®°å¿†"ï¼Œå‡å°‘é‡å¤åˆ†æ
- æ‰§è¡ŒæˆåŠŸç‡æå‡
- ç”¨æˆ·è¾“å…¥è´Ÿæ‹…é™ä½
- ç³»ç»ŸæŒç»­è‡ªåŠ¨å­¦ä¹ ä¼˜åŒ–


---

## åã€ChatGPT è¡¥å……è§‚ç‚¹æ•´åˆï¼ˆç¬¬äºŒè½®è®¨è®ºï¼‰

### 10.1 æ•°æ®æºå¯é æ€§åˆ†å±‚ï¼ˆç»†åŒ–ï¼‰

ChatGPT æå‡ºäº†æ›´ç»†åŒ–çš„æ•°æ®æºå¯é æ€§æ’åºï¼š

```python
# æ•°æ®æºå¯é æ€§æ’åºï¼ˆä»é«˜åˆ°ä½ï¼‰
1. action['element'] - æ‰§è¡Œæ—¶çš„å®é™…åæ ‡ï¼ˆ100%å‡†ç¡®ï¼‰
2. screenshot_analysis - OCR/UIåˆ†æç»“æœï¼ˆ90%å‡†ç¡®ï¼Œä½†å¯èƒ½æ²¡æœ‰ï¼‰
3. thinkingä¸­çš„åæ ‡ - æ¨¡å‹è‡ªå·±åˆ†æçš„åæ ‡ï¼ˆ70%å‡†ç¡®ï¼‰
4. thinkingä¸­çš„ä½ç½®æè¿° - "é¡¶éƒ¨ä¸­å¤®"ç­‰ï¼ˆ50%å‡†ç¡®ï¼Œä½†æ›´ç¨³å®šï¼‰
```

**Kiroé‡‡çº³**ï¼šè¿™ä¸ªåˆ†å±‚å¾ˆæœ‰ä»·å€¼ï¼Œå®ç°æ—¶æŒ‰æ­¤ä¼˜å…ˆçº§æå–ã€‚

### 10.2 å…ƒç´ ç‰¹å¾åŒ¹é…ï¼ˆæ–°å¢å›é€€æœºåˆ¶ï¼‰

å½“åæ ‡ä¸å‡†ç¡®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…ƒç´ ç‰¹å¾è¿›è¡ŒåŒ¹é…ï¼š

```python
@dataclass
class MentalShortcut:
    # ... åŸæœ‰å­—æ®µ ...
    
    # æ–°å¢ï¼šå…ƒç´ ç‰¹å¾ï¼ˆç”¨äºåŒ¹é…å›é€€ï¼‰
    element_features: Dict  # {
    #     "text": "æœç´¢",           # æ–‡æœ¬å†…å®¹ï¼ˆOCRï¼‰
    #     "icon": "search",         # å›¾æ ‡ç±»å‹
    #     "position": "top_center", # ä½ç½®æ ‡ç­¾
    #     "size": "large"           # å¤§å°æ ‡ç­¾
    # }
    
    # æ–°å¢ï¼šé€‚é…ç­–ç•¥
    adaptation_strategy: str  # "fixed" | "relative" | "ocr_match" | "hybrid"
```

**å¤šå±‚æ¬¡å›é€€æœºåˆ¶**ï¼š
```
åæ ‡åŒ¹é… â†’ ç›¸å¯¹ä½ç½®åŒ¹é… â†’ å…ƒç´ ç‰¹å¾åŒ¹é…ï¼ˆOCRæ–‡æœ¬/å›¾æ ‡ï¼‰
```

**Kiroé‡‡çº³**ï¼šä½œä¸ºç¬¬äºŒé˜¶æ®µçš„æ‰©å±•åŠŸèƒ½ã€‚

### 10.3 åœºæ™¯è¯†åˆ«å™¨ï¼ˆæ–°å¢ç»„ä»¶ï¼‰

ChatGPT å»ºè®®å¢åŠ å¤šæ¨¡æ€åœºæ™¯è¯†åˆ«ï¼š

```python
class SceneIdentifier:
    """åœºæ™¯è¯†åˆ«å™¨ - å¤šæ¨¡æ€èåˆ"""
    
    def identify_scene(
        self, 
        app: str,
        thinking: str,
        screenshot_path: str,
        current_app_state: Dict
    ) -> str:
        """
        å¤šæ¨¡æ€åœºæ™¯è¯†åˆ«
        
        ä¼˜å…ˆçº§ï¼š
        1. åº”ç”¨çŠ¶æ€ï¼ˆæœ€å¯é ï¼‰- ä»ç³»ç»ŸAPIè·å–activity name
        2. æˆªå›¾ç‰¹å¾ï¼ˆæ¬¡å¯é ï¼‰- è§†è§‰åˆ†æ
        3. thinkingæ–‡æœ¬ï¼ˆè¡¥å……ï¼‰- æ–‡æœ¬åˆ†æ
        """
        scene_scores = {}
        
        # 1. ä»åº”ç”¨çŠ¶æ€è¯†åˆ«ï¼ˆå¦‚æœæœ‰ï¼‰
        if app_state := current_app_state.get('activity'):
            # ä¾‹å¦‚ï¼šcom.tencent.mm.ui.LauncherUI -> "ä¸»é¡µ"
            scene_from_state = self._parse_activity(app_state)
            scene_scores[scene_from_state] = 0.9
        
        # 2. ä»æˆªå›¾ç‰¹å¾è¯†åˆ«
        screenshot_features = self._analyze_screenshot(screenshot_path)
        # æ£€æµ‹ï¼šåº•éƒ¨å¯¼èˆªæ ã€è¾“å…¥æ¡†ã€ç‰¹å®šUIå…ƒç´ ã€é¢œè‰²åˆ†å¸ƒ
        
        # 3. ä»thinkingæ–‡æœ¬è¯†åˆ«ï¼ˆè¡¥å……ï¼‰
        scene_from_thinking = self._extract_scene_from_thinking(thinking)
        
        return max(scene_scores.items(), key=lambda x: x[1])[0]
```

**Kiroé‡‡çº³**ï¼šéƒ¨åˆ†é‡‡çº³ï¼Œç¬¬ä¸€é˜¶æ®µç®€åŒ–ä¸ºåªæŒ‰åº”ç”¨åˆ†ç±»ï¼Œç¬¬äºŒé˜¶æ®µå†å¢åŠ åœºæ™¯è¯†åˆ«ã€‚

### 10.4 åˆ†æ­¥éª¤åŠ¨æ€æç¤ºè¯ï¼ˆé‡è¦æ”¹è¿›ï¼‰

ChatGPT æå‡ºæ ¹æ®å½“å‰æ­¥éª¤åŠ¨æ€è°ƒæ•´æç¤ºè¯å†…å®¹ï¼Œé¿å…ä¿¡æ¯è¿‡è½½ï¼š

```python
def build_enhanced_prompt(
    self,
    task: str,
    matched_golden_path: Optional[Dict],
    current_app: str,
    current_scene: str,
    step_num: int = 1  # å½“å‰æ­¥éª¤å·
) -> str:
    """åˆ†æ­¥éª¤åŠ¨æ€æç¤ºè¯"""
    prompt_parts = [task]
    
    # ========== æ­¥éª¤1-2ï¼šä»»åŠ¡çº§æŒ‡å¯¼ï¼ˆé»„é‡‘è·¯å¾„ï¼‰==========
    if step_num <= 2 and matched_golden_path:
        if correct_path := matched_golden_path.get('correct_path'):
            prompt_parts.append("\n\nğŸ“‹ ä»»åŠ¡æ­¥éª¤ï¼š")
            # åªæ˜¾ç¤ºå‰3æ­¥ï¼Œé¿å…ä¿¡æ¯è¿‡è½½
            for i, step in enumerate(correct_path[:3], 1):
                prompt_parts.append(f"æ­¥éª¤{i}: {step}")
        
        if forbidden := matched_golden_path.get('forbidden'):
            prompt_parts.append("\n\nâŒ ç¦æ­¢æ“ä½œï¼š")
            for f in forbidden[:2]:  # æœ€å¤š2æ¡
                prompt_parts.append(f"- {f}")
    
    # ========== æ­¥éª¤3+ï¼šå…ƒç´ çº§æŒ‡å¯¼ï¼ˆæ€ç»´æ·å¾„ï¼‰==========
    if step_num >= 3:
        shortcuts = self.shortcut_repo.find_by_app_scene(current_app, current_scene)
        if shortcuts:
            prompt_parts.append(f"\n\nğŸ“ å½“å‰é¡µé¢å…ƒç´ ä½ç½®æç¤ºï¼š")
            for sc in shortcuts[:3]:  # åªæ˜¾ç¤º3ä¸ªæœ€ç›¸å…³çš„
                coord_str = f"({sc.typical_coords[0]},{sc.typical_coords[1]})"
                prompt_parts.append(f"- {sc.element}: {sc.location_hint}ï¼Œå‚è€ƒ{coord_str}")
    
    return "\n".join(prompt_parts)
```

**å…³é”®æ”¹è¿›ç‚¹**ï¼š
- æ­¥éª¤1-2ï¼šæ˜¾ç¤ºä»»åŠ¡åˆ†è§£ï¼ˆé»„é‡‘è·¯å¾„ï¼‰
- æ­¥éª¤3+ï¼šæ˜¾ç¤ºå…ƒç´ ä½ç½®ï¼ˆæ€ç»´æ·å¾„ï¼‰
- é™åˆ¶ä¿¡æ¯é‡ï¼Œé€‚é…9Bå°æ¨¡å‹

**Kiroé‡‡çº³**ï¼šéå¸¸é‡è¦çš„æ”¹è¿›ï¼Œå®Œå…¨é‡‡çº³ã€‚

### 10.5 è´¨é‡æ§åˆ¶å™¨ï¼ˆæ–°å¢ç»„ä»¶ï¼‰

ChatGPT å»ºè®®å¢åŠ ä¸¥æ ¼çš„è´¨é‡æ§åˆ¶æœºåˆ¶ï¼š

```python
class ShortcutQualityController:
    """æ€ç»´æ·å¾„è´¨é‡æ§åˆ¶å™¨"""
    
    def validate_shortcut(self, shortcut: MentalShortcut) -> bool:
        """éªŒè¯æ·å¾„è´¨é‡"""
        checks = []
        
        # 1. åŸºç¡€ä¿¡æ¯å®Œæ•´æ€§
        checks.append(bool(shortcut.app and shortcut.element))
        checks.append(bool(shortcut.typical_coords))
        
        # 2. ä½¿ç”¨ç»Ÿè®¡
        checks.append(shortcut.usage_count >= 3)
        success_rate = shortcut.success_count / shortcut.usage_count
        checks.append(success_rate >= 0.8)
        
        # 3. åæ ‡ç¨³å®šæ€§
        if shortcut.coord_variance:
            max_variance = max(shortcut.coord_variance)
            checks.append(max_variance < 100)  # åæ ‡å˜åŒ–ä¸èƒ½å¤ªå¤§
        
        # 4. ç½®ä¿¡åº¦
        checks.append(shortcut.confidence >= 0.7)
        
        # 5. æ—¶é—´æœ‰æ•ˆæ€§ï¼ˆå¯é€‰ï¼‰
        # å¦‚æœæ·å¾„å¤ªæ—§ï¼ˆå¦‚6ä¸ªæœˆï¼‰ï¼Œå¯èƒ½éœ€è¦é‡æ–°éªŒè¯
        
        return all(checks)
    
    def should_inject(self, shortcut: MentalShortcut, context: Dict) -> bool:
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥æ³¨å…¥åˆ°å½“å‰ä¸Šä¸‹æ–‡"""
        if not self.validate_shortcut(shortcut):
            return False
        
        if context.get('app') != shortcut.app:
            return False
        
        if scene := context.get('scene'):
            if shortcut.scene != scene:
                return False
        
        min_confidence = context.get('min_confidence', 0.8)
        if shortcut.confidence < min_confidence:
            return False
        
        return True
```

**Kiroé‡‡çº³**ï¼šå¿…é¡»æœ‰è´¨é‡æ§åˆ¶ï¼Œå®Œå…¨é‡‡çº³ã€‚

### 10.6 æ¸è¿›å¼å­¦ä¹ é˜ˆå€¼ï¼ˆæ›´ä¸¥æ ¼ï¼‰

ChatGPT å»ºè®®ç¬¬ä¸€é˜¶æ®µä½¿ç”¨æ›´ä¸¥æ ¼çš„é˜ˆå€¼ï¼š

| é˜¶æ®µ | ä½¿ç”¨æ¬¡æ•° | æˆåŠŸç‡ | åæ ‡æ–¹å·® | è¯´æ˜ |
|------|---------|--------|---------|------|
| **ç¬¬ä¸€é˜¶æ®µï¼ˆä¿å®ˆï¼‰** | â‰¥5æ¬¡ | â‰¥95% | <30 | åªæå–æœ€å¯é çš„ |
| **ç¬¬äºŒé˜¶æ®µï¼ˆæ‰©å±•ï¼‰** | â‰¥3æ¬¡ | â‰¥80% | <50 | å¢åŠ æ›´å¤šä¿¡æ¯ |
| **ç¬¬ä¸‰é˜¶æ®µï¼ˆè‡ªé€‚åº”ï¼‰** | åŠ¨æ€ | åŠ¨æ€ | åŠ¨æ€ | æ ¹æ®åº”ç”¨ç±»å‹è°ƒæ•´ |

**Kiroé‡‡çº³**ï¼šç¬¬ä¸€é˜¶æ®µç¡®å®åº”è¯¥æ›´ä¿å®ˆï¼Œé‡‡çº³æ›´ä¸¥æ ¼çš„é˜ˆå€¼ã€‚

---

## åä¸€ã€æœ€ç»ˆæ–¹æ¡ˆç¡®è®¤ï¼ˆæ•´åˆä¸¤è½®è®¨è®ºï¼‰

### 11.1 æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»Ÿä¸€ç»éªŒç³»ç»Ÿ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   é»„é‡‘è·¯å¾„ç³»ç»Ÿ   â”‚    â”‚  æ€ç»´æ·å¾„ç³»ç»Ÿ   â”‚                â”‚
â”‚  â”‚  (ä»»åŠ¡çº§æŒ‡å¯¼)    â”‚    â”‚  (å…ƒç´ çº§æŒ‡å¯¼)   â”‚                â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚                â”‚
â”‚  â”‚ - correct_path  â”‚    â”‚ - app           â”‚                â”‚
â”‚  â”‚ - forbidden     â”‚    â”‚ - scene         â”‚                â”‚
â”‚  â”‚ - hints         â”‚    â”‚ - element       â”‚                â”‚
â”‚  â”‚                 â”‚    â”‚ - coords        â”‚                â”‚
â”‚  â”‚                 â”‚    â”‚ - location_hint â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                      â”‚                          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                      â–¼                                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚           â”‚   è´¨é‡æ§åˆ¶å™¨        â”‚                          â”‚
â”‚           â”‚ - validate_shortcut â”‚                          â”‚
â”‚           â”‚ - should_inject     â”‚                          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                      â–¼                                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚           â”‚  åˆ†æ­¥éª¤æç¤ºè¯æ„å»ºå™¨  â”‚                          â”‚
â”‚           â”‚ - æ­¥éª¤1-2: ä»»åŠ¡æŒ‡å¯¼ â”‚                          â”‚
â”‚           â”‚ - æ­¥éª¤3+: å…ƒç´ ä½ç½®  â”‚                          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 æ•°æ®æå–ç­–ç•¥

```python
# æå–ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰
def extract_shortcut(step_data):
    # 1. åæ ‡ï¼šä»actionè·å–ï¼ˆ100%å‡†ç¡®ï¼‰
    coords = step_data['action'].get('element', [])
    confidence = 1.0
    
    # 2. ä½ç½®æè¿°ï¼šä»thinkingæå–ï¼ˆè¡¥å……ä¿¡æ¯ï¼‰
    location_hint = extract_location_from_thinking(step_data['thinking'])
    
    # 3. å…ƒç´ åç§°ï¼šä»thinkingæå–
    element = extract_element_from_thinking(step_data['thinking'])
    
    # 4. åº”ç”¨åï¼šä»current_appè·å–
    app = step_data['app']
    
    # 5. åœºæ™¯ï¼šç¬¬ä¸€é˜¶æ®µæš‚ä¸æå–ï¼Œç¬¬äºŒé˜¶æ®µå¢åŠ 
    scene = "æœªçŸ¥é¡µé¢"  # ç¬¬ä¸€é˜¶æ®µ
    
    return MentalShortcut(
        app=app,
        scene=scene,
        element=element,
        location_hint=location_hint,
        typical_coords=coords,
        confidence=confidence
    )
```

### 11.3 æ³¨å…¥ç­–ç•¥

```python
def inject_experience(task, golden_path, shortcuts, step_num):
    prompt = task
    
    # æ­¥éª¤1-2ï¼šä»»åŠ¡çº§æŒ‡å¯¼
    if step_num <= 2 and golden_path:
        prompt += format_golden_path(golden_path)
    
    # æ­¥éª¤3+ï¼šå…ƒç´ çº§æŒ‡å¯¼
    if step_num >= 3:
        valid_shortcuts = [s for s in shortcuts if quality_controller.should_inject(s)]
        if valid_shortcuts:
            prompt += format_shortcuts(valid_shortcuts[:3])
    
    # å§‹ç»ˆæ·»åŠ å…è´£å£°æ˜
    prompt += "\n\nâš ï¸ ä»¥ä¸Šä½ç½®ä»…ä¾›å‚è€ƒï¼Œå¦‚æœç•Œé¢æœ‰å˜åŒ–ï¼Œè¯·é‡æ–°åˆ†æã€‚"
    
    return prompt
```

### 11.4 å®æ–½è·¯çº¿å›¾

```
ç¬¬ä¸€é˜¶æ®µï¼ˆ2å‘¨ï¼‰- åŸºç¡€ç‰ˆ
â”œâ”€â”€ ThinkingExtractor - ä»actionæå–åæ ‡ï¼Œä»thinkingæå–ä½ç½®æè¿°
â”œâ”€â”€ MentalShortcutRepository - å­˜å‚¨åˆ°æ•°æ®åº“
â”œâ”€â”€ ShortcutQualityController - ä¸¥æ ¼éªŒè¯ï¼ˆä½¿ç”¨â‰¥5æ¬¡ï¼ŒæˆåŠŸç‡â‰¥95%ï¼‰
â”œâ”€â”€ ShortcutInjector - åŸºç¡€æ³¨å…¥
â””â”€â”€ ä¿®æ”¹AgentRunner - é›†æˆç³»ç»Ÿ

ç¬¬äºŒé˜¶æ®µï¼ˆ2å‘¨ï¼‰- å¢å¼ºç‰ˆ
â”œâ”€â”€ SceneIdentifier - åœºæ™¯è¯†åˆ«
â”œâ”€â”€ å…ƒç´ ç‰¹å¾åŒ¹é… - OCRæ–‡æœ¬ã€å›¾æ ‡ç±»å‹
â”œâ”€â”€ åˆ†æ­¥éª¤åŠ¨æ€æç¤ºè¯ - æ ¹æ®æ­¥éª¤è°ƒæ•´å†…å®¹
â””â”€â”€ æ”¾å®½é˜ˆå€¼ï¼ˆä½¿ç”¨â‰¥3æ¬¡ï¼ŒæˆåŠŸç‡â‰¥80%ï¼‰

ç¬¬ä¸‰é˜¶æ®µï¼ˆ2å‘¨ï¼‰- è‡ªé€‚åº”ç‰ˆ
â”œâ”€â”€ è‡ªåŠ¨æ·˜æ±°ä½è´¨é‡æ·å¾„
â”œâ”€â”€ å¤šè®¾å¤‡é€‚é…
â”œâ”€â”€ è·¯å¾„è‡ªåŠ¨ä¼˜åŒ–
â””â”€â”€ ä¸é»„é‡‘è·¯å¾„æ·±åº¦æ•´åˆ
```

### 11.5 æ–°å¢æ–‡ä»¶æ¸…å•

```
gui/utils/
â”œâ”€â”€ thinking_extractor.py        # æ€ç»´æ·å¾„æå–å™¨
â”œâ”€â”€ mental_shortcut_repository.py # æ€ç»´æ·å¾„å­˜å‚¨
â”œâ”€â”€ shortcut_injector.py         # æ·å¾„æ³¨å…¥å™¨
â”œâ”€â”€ shortcut_quality_controller.py # è´¨é‡æ§åˆ¶å™¨ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ scene_identifier.py          # åœºæ™¯è¯†åˆ«å™¨ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰
â””â”€â”€ unified_experience_system.py # ç»Ÿä¸€ç»éªŒç³»ç»Ÿï¼ˆæ•´åˆï¼‰
```

### 11.6 é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | å½“å‰ | ç¬¬ä¸€é˜¶æ®µå | ç¬¬äºŒé˜¶æ®µå | ç¬¬ä¸‰é˜¶æ®µå |
|------|------|-----------|-----------|-----------|
| æ‰§è¡ŒæˆåŠŸç‡ | ~60% | ~70% | ~80% | ~85% |
| å¹³å‡æ‰§è¡Œæ—¶é—´ | åŸºå‡† | -10% | -20% | -30% |
| ç”¨æˆ·è¾“å…¥å¤æ‚åº¦ | é«˜ | ä¸­ | ä½ | å¾ˆä½ |
| ç³»ç»Ÿå­¦ä¹ èƒ½åŠ› | è¢«åŠ¨ | ä¸»åŠ¨ | æ™ºèƒ½ | è‡ªé€‚åº” |

---

## åäºŒã€å¾…ç¡®è®¤äº‹é¡¹

åœ¨å¼€å§‹å®ç°ä¹‹å‰ï¼Œéœ€è¦ç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

1. **ç¬¬ä¸€é˜¶æ®µçš„éªŒè¯é˜ˆå€¼**ï¼šä½¿ç”¨â‰¥5æ¬¡ï¼ŒæˆåŠŸç‡â‰¥95%ï¼Œæ˜¯å¦å¤ªä¸¥æ ¼ï¼Ÿ
2. **åœºæ™¯è¯†åˆ«**ï¼šç¬¬ä¸€é˜¶æ®µæ˜¯å¦å®Œå…¨è·³è¿‡ï¼Œè¿˜æ˜¯åšç®€å•çš„åº”ç”¨å†…é¡µé¢åŒºåˆ†ï¼Ÿ
3. **æ•°æ®åº“ç»“æ„**ï¼šæ˜¯æ–°å»ºè¡¨è¿˜æ˜¯æ‰©å±•ç°æœ‰è¡¨ï¼Ÿ
4. **ä¸ç°æœ‰ç³»ç»Ÿçš„æ•´åˆç‚¹**ï¼šä¼˜å…ˆä¿®æ”¹å“ªä¸ªæ–‡ä»¶ï¼Ÿ

è¯·ç¡®è®¤åå³å¯å¼€å§‹å®ç°ã€‚



---

## åä¸‰ã€ChatGPT ç¬¬ä¸‰è½®è¯„ä»·ä¸è¡¥å……ï¼ˆç¬¬ä¸ƒèŠ‚å†…å®¹æ•´åˆï¼‰

### 13.1 ChatGPT å¯¹æ–¹æ¡ˆçš„æ•´ä½“è¯„ä»·

ChatGPT å¯¹æˆ‘ä»¬æ•´åˆçš„æ–¹æ¡ˆç»™å‡ºäº†**å®Œå…¨èµåŒ**çš„è¯„ä»·ï¼š

| å†…å®¹ | è¯„ä»· |
|------|------|
| æ•°æ®æºå¯é æ€§åˆ†å±‚ | âœ… å®Œå…¨èµåŒï¼Œä¼˜å…ˆçº§æ’åºåˆç† |
| å…ƒç´ ç‰¹å¾åŒ¹é… | âœ… éå¸¸èµåŒï¼Œå¤šå±‚æ¬¡å›é€€æœºåˆ¶å¿…é¡»æœ‰ |
| åˆ†æ­¥éª¤åŠ¨æ€æç¤ºè¯ | âœ… å®Œå…¨èµåŒï¼Œæ˜¯é€‚é…å°æ¨¡å‹çš„å…³é”® |
| è´¨é‡æ§åˆ¶å™¨ | âœ… å®Œå…¨èµåŒï¼Œæ˜¯ç³»ç»Ÿå¯é æ€§çš„åŸºç¡€ |
| æ¸è¿›å¼å­¦ä¹ é˜ˆå€¼ | âœ… å®Œå…¨èµåŒï¼Œé˜ˆå€¼è®¾è®¡ç§‘å­¦ |
| æœ€ç»ˆæ–¹æ¡ˆæ¶æ„ | âœ… æ¶æ„è®¾è®¡åˆç† |

### 13.2 æ–°å¢è¡¥å……å»ºè®®

#### è¡¥å……1ï¼šç½®ä¿¡åº¦è¡°å‡æœºåˆ¶

æ ¹æ®æ•°æ®æºç±»å‹è‡ªåŠ¨è°ƒæ•´ç½®ä¿¡åº¦ï¼š

```python
def calculate_confidence(data_source: str, raw_confidence: float) -> float:
    """æ ¹æ®æ•°æ®æºç±»å‹è°ƒæ•´ç½®ä¿¡åº¦"""
    source_weights = {
        'action': 1.0,           # ä¸è¡°å‡ï¼ˆæœ€å¯é ï¼‰
        'screenshot': 0.9,       # è½»å¾®è¡°å‡
        'thinking_coords': 0.7,  # æ˜æ˜¾è¡°å‡
        'thinking_location': 0.5 # å¤§å¹…è¡°å‡
    }
    return raw_confidence * source_weights.get(data_source, 0.5)
```

**Kiroé‡‡çº³**ï¼šâœ… å¥½ä¸»æ„ï¼Œå®ç°æ—¶åŠ å…¥ã€‚

#### è¡¥å……2ï¼šç‰¹å¾åŒ¹é…ä¼˜å…ˆçº§

å½“åæ ‡åŒ¹é…å¤±è´¥æ—¶ï¼ŒæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§è¿›è¡Œç‰¹å¾åŒ¹é…ï¼š

```python
# ç‰¹å¾åŒ¹é…ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰
1. OCRæ–‡æœ¬åŒ¹é… - "æœç´¢"ã€"å‘é€"ç­‰ï¼ˆæœ€å‡†ç¡®ï¼Œ95%ç½®ä¿¡åº¦ï¼‰
2. å›¾æ ‡ç±»å‹åŒ¹é… - "search"ã€"send"ç­‰ï¼ˆæ¬¡å‡†ç¡®ï¼Œ85%ç½®ä¿¡åº¦ï¼‰
3. ä½ç½®æ ‡ç­¾åŒ¹é… - "top_center"ã€"bottom_nav"ç­‰ï¼ˆè¡¥å……ï¼Œ75%ç½®ä¿¡åº¦ï¼‰
4. å¤§å°æ ‡ç­¾åŒ¹é… - "large"ã€"small"ç­‰ï¼ˆè¾…åŠ©ï¼Œ65%ç½®ä¿¡åº¦ï¼‰
```

**Kiroé‡‡çº³**ï¼šâœ… åˆç†ï¼Œç¬¬äºŒé˜¶æ®µå®ç°ã€‚

#### è¡¥å……3ï¼šæ›´ç»†åŒ–çš„æ­¥éª¤åˆ’åˆ†

```python
def build_enhanced_prompt(self, task, golden_path, shortcuts, step_num, current_app, current_scene):
    """æ›´ç»†åŒ–çš„åˆ†æ­¥éª¤æç¤ºè¯"""
    prompt_parts = [task]
    
    # ========== æ­¥éª¤1ï¼šä»»åŠ¡æ¦‚è§ˆ ==========
    if step_num == 1:
        if golden_path and golden_path.get('correct_path'):
            prompt_parts.append("\n\nğŸ“‹ ä»»åŠ¡å°†åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š")
            for i, step in enumerate(golden_path['correct_path'], 1):
                prompt_parts.append(f"{i}. {step}")
        
        if golden_path and golden_path.get('forbidden'):
            prompt_parts.append("\n\nâŒ é‡è¦çº¦æŸï¼š")
            for f in golden_path['forbidden'][:2]:
                prompt_parts.append(f"- {f}")
    
    # ========== æ­¥éª¤2-3ï¼šå½“å‰æ­¥éª¤è¯¦ç»†æŒ‡å¯¼ ==========
    elif step_num in [2, 3]:
        if golden_path and golden_path.get('correct_path') and step_num <= len(golden_path['correct_path']):
            current_step = golden_path['correct_path'][step_num - 1]
            prompt_parts.append(f"\n\nğŸ“‹ å½“å‰æ­¥éª¤ï¼ˆæ­¥éª¤{step_num}ï¼‰ï¼š{current_step}")
            
            # æ˜¾ç¤ºä¸‹ä¸€æ­¥é¢„è§ˆ
            if step_num < len(golden_path['correct_path']):
                next_step = golden_path['correct_path'][step_num]
                prompt_parts.append(f"ä¸‹ä¸€æ­¥ï¼š{next_step}")
    
    # ========== æ­¥éª¤4+ï¼šå…ƒç´ ä½ç½®æŒ‡å¯¼ ==========
    else:
        if shortcuts:
            prompt_parts.append(f"\n\nğŸ“ å½“å‰é¡µé¢å…ƒç´ ä½ç½®æç¤ºï¼š")
            for sc in shortcuts[:3]:
                coord_str = f"({sc.typical_coords[0]},{sc.typical_coords[1]})"
                prompt_parts.append(f"- {sc.element}: {sc.location_hint}ï¼Œå‚è€ƒ{coord_str}")
    
    return "\n".join(prompt_parts)
```

**Kiroé‡‡çº³**ï¼šâœ… æœ‰ä»·å€¼ï¼Œé‡‡çº³è¿™ä¸ªæ›´ç»†åŒ–çš„åˆ’åˆ†ã€‚

#### è¡¥å……4ï¼šå­¦ä¹ æœŸæœºåˆ¶ï¼ˆé‡è¦ï¼‰

é¿å…æ—©æœŸæ•°æ®å™ªéŸ³ï¼š

```python
class LearningPeriodController:
    """å­¦ä¹ æœŸæ§åˆ¶å™¨"""
    
    def __init__(self, learning_period: int = 10):
        self.learning_period = learning_period  # å­¦ä¹ æœŸæ¬¡æ•°
    
    def should_record(self, shortcut: MentalShortcut) -> bool:
        """æ˜¯å¦åº”è¯¥è®°å½•ï¼ˆå§‹ç»ˆè®°å½•ï¼‰"""
        return True
    
    def should_inject(self, shortcut: MentalShortcut) -> bool:
        """æ˜¯å¦åº”è¯¥æ³¨å…¥ï¼ˆå­¦ä¹ æœŸåæ‰æ³¨å…¥ï¼‰"""
        # å‰Næ¬¡æ‰§è¡Œï¼šåªè®°å½•ï¼Œä¸æ³¨å…¥
        if shortcut.usage_count < self.learning_period:
            return False
        
        # å­¦ä¹ æœŸåï¼šå¼€å§‹éªŒè¯å’Œæ³¨å…¥
        return self._validate_after_learning(shortcut)
    
    def _validate_after_learning(self, shortcut: MentalShortcut) -> bool:
        """å­¦ä¹ æœŸåçš„éªŒè¯"""
        success_rate = shortcut.success_count / shortcut.usage_count
        return success_rate >= 0.8  # æˆåŠŸç‡â‰¥80%æ‰æ³¨å…¥
```

**Kiroé‡‡çº³**ï¼šâœ… å¥½å»ºè®®ï¼Œé¿å…æ—©æœŸå™ªéŸ³å½±å“ã€‚

#### è¡¥å……5ï¼šåº”ç”¨ç±»å‹å·®å¼‚åŒ–é˜ˆå€¼ï¼ˆç¬¬ä¸‰é˜¶æ®µï¼‰

```python
def get_thresholds_by_app_type(self, app: str) -> Dict:
    """æ ¹æ®åº”ç”¨ç±»å‹è¿”å›ä¸åŒçš„é˜ˆå€¼"""
    app_types = {
        'ç¤¾äº¤': {'min_usage': 3, 'min_success_rate': 0.85, 'max_variance': 40},
        'è´­ç‰©': {'min_usage': 4, 'min_success_rate': 0.90, 'max_variance': 35},
        'å·¥å…·': {'min_usage': 5, 'min_success_rate': 0.95, 'max_variance': 30},
        'é»˜è®¤': {'min_usage': 5, 'min_success_rate': 0.95, 'max_variance': 30}
    }
    
    app_type = self._classify_app(app)
    return app_types.get(app_type, app_types['é»˜è®¤'])
```

**Kiroé‡‡çº³**ï¼šâš ï¸ ç¬¬ä¸‰é˜¶æ®µå†è€ƒè™‘ï¼Œç¬¬ä¸€é˜¶æ®µå…ˆç»Ÿä¸€é˜ˆå€¼ã€‚

### 13.3 å¾…ç¡®è®¤äº‹é¡¹çš„æœ€ç»ˆå»ºè®®

| äº‹é¡¹ | ChatGPTå»ºè®® | Kiroå†³å®š |
|------|------------|---------|
| ç¬¬ä¸€é˜¶æ®µéªŒè¯é˜ˆå€¼ | åˆç†ï¼Œä½†å¢åŠ "å­¦ä¹ æœŸ"æœºåˆ¶ | âœ… é‡‡çº³å­¦ä¹ æœŸï¼ˆå‰10æ¬¡åªè®°å½•ï¼‰ |
| åœºæ™¯è¯†åˆ« | ç¬¬ä¸€é˜¶æ®µåªåŒºåˆ†"ä¸»é¡µ"å’Œ"éä¸»é¡µ" | âœ… åŒæ„ç®€åŒ– |
| æ•°æ®åº“ç»“æ„ | æ–°å»ºè¡¨ï¼ˆä¾¿äºç‹¬ç«‹ä¼˜åŒ–ï¼‰ | âœ… åŒæ„æ–°å»ºè¡¨ |
| æ•´åˆä¼˜å…ˆçº§ | AgentRunner â†’ PhoneAgent â†’ GoldenPathExtractor | âœ… åŒæ„æ­¤é¡ºåº |

### 13.4 é£é™©æ§åˆ¶è¡¥å……

ChatGPT å¼ºè°ƒçš„é£é™©æ§åˆ¶æªæ–½ï¼š

1. **æ¯ä¸ªé˜¶æ®µéƒ½è¦æœ‰å›é€€æœºåˆ¶**
   - å¦‚æœæ·å¾„å¤±æ•ˆï¼Œæ¨¡å‹åº”è¯¥èƒ½è‡ªåŠ¨å›é€€åˆ°æ­£å¸¸åˆ†æ
   
2. **å¢åŠ ç›‘æ§å’Œæ—¥å¿—**
   - è®°å½•æ·å¾„çš„ä½¿ç”¨æƒ…å†µå’ŒæˆåŠŸç‡
   - åŠæ—¶å‘ç°å¼‚å¸¸æ•°æ®
   
3. **æ€§èƒ½è€ƒè™‘**
   - æ•°æ®åº“æŸ¥è¯¢è¦ä¼˜åŒ–ï¼ˆç´¢å¼•ï¼‰
   - æ·å¾„åŒ¹é…è¦å¿«é€Ÿï¼ˆç¼“å­˜å¸¸ç”¨æ·å¾„ï¼‰
   - æç¤ºè¯æ„å»ºè¦é«˜æ•ˆï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰

---

## åå››ã€æœ€ç»ˆç¡®è®¤æ–¹æ¡ˆï¼ˆä¸‰è½®è®¨è®ºæ•´åˆï¼‰

### 14.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **æ•°æ®è´¨é‡ä¼˜å…ˆ**ï¼šå®å¯å°‘æå–ï¼Œä¹Ÿä¸è¦æå–é”™è¯¯ä¿¡æ¯
2. **æ¸è¿›å¼å®æ–½**ï¼šå…ˆä¿å®ˆåæ‰©å±•ï¼Œæ¯é˜¶æ®µéªŒè¯æ•ˆæœ
3. **é€‚é…å°æ¨¡å‹**ï¼šä¿¡æ¯é‡æ§åˆ¶ï¼Œæç¤ºè¯ç®€æ´
4. **å¤šå±‚æ¬¡å›é€€**ï¼šåæ ‡ â†’ ç›¸å¯¹ä½ç½® â†’ å…ƒç´ ç‰¹å¾ â†’ æ¨¡å‹è‡ªå·±åˆ†æ

### 14.2 ç¬¬ä¸€é˜¶æ®µå®æ–½ç»†èŠ‚ï¼ˆç¡®è®¤ç‰ˆï¼‰

**æ—¶é—´**ï¼š2å‘¨

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. `ThinkingExtractor` - ä»actionæå–åæ ‡ï¼ˆ100%å‡†ç¡®ï¼‰
2. `MentalShortcutRepository` - æ–°å»ºæ•°æ®åº“è¡¨å­˜å‚¨
3. `ShortcutQualityController` - ä¸¥æ ¼éªŒè¯ + å­¦ä¹ æœŸæœºåˆ¶
4. `ShortcutInjector` - åŸºç¡€æ³¨å…¥ï¼ˆåˆ†æ­¥éª¤ï¼‰

**éªŒè¯æ¡ä»¶**ï¼š
- å­¦ä¹ æœŸï¼šå‰10æ¬¡åªè®°å½•ï¼Œä¸æ³¨å…¥
- å­¦ä¹ æœŸåï¼šä½¿ç”¨â‰¥5æ¬¡ï¼ŒæˆåŠŸç‡â‰¥95%ï¼Œåæ ‡æ–¹å·®<30

**åœºæ™¯è¯†åˆ«**ï¼š
- ç®€åŒ–ä¸ºåªåŒºåˆ†"ä¸»é¡µ"å’Œ"éä¸»é¡µ"
- é€šè¿‡æ£€æµ‹åº•éƒ¨å¯¼èˆªæ å®ç°

**æ•´åˆé¡ºåº**ï¼š
1. `AgentRunner.run_task()` - ä»»åŠ¡å¼€å§‹æ—¶æ³¨å…¥
2. `AgentRunner._build_enhanced_prompt()` - å¢å¼ºæç¤ºè¯
3. åç»­å†æ‰©å±•åˆ°å…¶ä»–ç»„ä»¶

### 14.3 æ•°æ®åº“è¡¨ç»“æ„ï¼ˆç¡®è®¤ç‰ˆï¼‰

```sql
-- æ–°å»ºè¡¨ï¼šmental_shortcuts
CREATE TABLE IF NOT EXISTS mental_shortcuts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    
    -- åŸºç¡€ä¿¡æ¯
    app TEXT NOT NULL,                    -- åº”ç”¨å
    scene TEXT DEFAULT 'æœªçŸ¥é¡µé¢',         -- åœºæ™¯ï¼ˆç®€åŒ–ç‰ˆï¼šä¸»é¡µ/éä¸»é¡µï¼‰
    element TEXT NOT NULL,                -- UIå…ƒç´ å
    
    -- ä½ç½®ä¿¡æ¯
    location_hint TEXT,                   -- ä½ç½®æè¿°ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰
    typical_coords TEXT,                  -- JSON: [x, y]ï¼ˆå½’ä¸€åŒ–åæ ‡ï¼‰
    coord_variance TEXT,                  -- JSON: [var_x, var_y]
    
    -- åŠ¨ä½œä¿¡æ¯
    action TEXT,                          -- åŠ¨ä½œç±»å‹ï¼ˆTap/Type/Swipeç­‰ï¼‰
    
    -- æ•°æ®æºä¿¡æ¯
    data_source TEXT DEFAULT 'action',    -- æ•°æ®æ¥æºï¼ˆaction/screenshot/thinkingï¼‰
    
    -- ç»Ÿè®¡ä¿¡æ¯
    confidence REAL DEFAULT 1.0,          -- ç½®ä¿¡åº¦ï¼ˆå«è¡°å‡ï¼‰
    usage_count INTEGER DEFAULT 1,        -- ä½¿ç”¨æ¬¡æ•°
    success_count INTEGER DEFAULT 1,      -- æˆåŠŸæ¬¡æ•°
    
    -- å…ƒæ•°æ®
    source_sessions TEXT,                 -- JSON: [session_id, ...]
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_shortcuts_app ON mental_shortcuts(app);
CREATE INDEX idx_shortcuts_app_scene ON mental_shortcuts(app, scene);
CREATE INDEX idx_shortcuts_confidence ON mental_shortcuts(confidence);
```

### 14.4 é¢„æœŸæ•ˆæœï¼ˆç¡®è®¤ç‰ˆï¼‰

| æŒ‡æ ‡ | å½“å‰ | ç¬¬ä¸€é˜¶æ®µå | è¯´æ˜ |
|------|------|-----------|------|
| æ‰§è¡ŒæˆåŠŸç‡ | ~60% | ~70% | é€šè¿‡ä½ç½®æç¤ºå‡å°‘é”™è¯¯ |
| å¹³å‡æ‰§è¡Œæ—¶é—´ | åŸºå‡† | -10% | å‡å°‘ç•Œé¢åˆ†ææ—¶é—´ |
| ç”¨æˆ·è¾“å…¥å¤æ‚åº¦ | é«˜ | ä¸­ | ç³»ç»Ÿè‡ªåŠ¨å­¦ä¹  |
| æ•°æ®è´¨é‡ | - | é«˜ | ä¸¥æ ¼éªŒè¯ + å­¦ä¹ æœŸ |

---

## åäº”ã€å¼€å§‹å®ç°

æ–¹æ¡ˆå·²ç»è¿‡ä¸‰è½®è®¨è®ºï¼Œè¾¾æˆå®Œå…¨å…±è¯†ã€‚ç°åœ¨å¯ä»¥å¼€å§‹å®ç°ç¬¬ä¸€é˜¶æ®µã€‚

**å®ç°é¡ºåº**ï¼š
1. åˆ›å»ºæ•°æ®åº“è¡¨ `mental_shortcuts`
2. å®ç° `ThinkingExtractor` ç±»
3. å®ç° `MentalShortcutRepository` ç±»
4. å®ç° `ShortcutQualityController` ç±»ï¼ˆå«å­¦ä¹ æœŸï¼‰
5. å®ç° `ShortcutInjector` ç±»
6. ä¿®æ”¹ `AgentRunner` é›†æˆç³»ç»Ÿ
7. æµ‹è¯•å’ŒéªŒè¯

**ç¡®è®¤åå³å¯å¼€å§‹ç¼–ç ã€‚**

